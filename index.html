<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NaraBooth Deluxe V10</title>
    <style>
        :root { --accent: #ff7675; --bg: #1a1a1a; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; text-align: center; }
        .container { max-width: 450px; margin: auto; background: #2d3436; padding: 20px; border-radius: 35px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); border: 2px solid #3d4446; }
        .screen { position: relative; background: #000; border-radius: 20px; overflow: hidden; aspect-ratio: 4/3; border: 4px solid #1a1a1a; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .timer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 100px; font-weight: 900; z-index: 100; color: white; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        select, input[type="color"] { background: #3d4446; border: none; color: white; padding: 12px; border-radius: 12px; font-weight: bold; }
        .sticker-box { display: flex; gap: 12px; overflow-x: auto; padding: 10px; background: #1a1a1a; border-radius: 15px; margin-bottom: 15px; }
        .sticker-item { font-size: 30px; cursor: pointer; min-width: 45px; }
        #startBtn { width: 100%; background: linear-gradient(45deg, #ff7675, #ef5777); color: white; border: none; padding: 18px; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; }
        canvas { max-width: 100%; border-radius: 15px; margin-top: 20px; display: none; touch-action: none; }
        .btn-save { background: #00b894; color: white; border: none; padding: 15px; border-radius: 15px; width: 100%; margin-top: 10px; display: none; font-weight: bold; }
        .flash-active { background: white !important; transition: 0.1s; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="margin:0; color:var(--accent);">NARABOOTH Deluxe</h2>
    <p style="font-size:10px; opacity:0.5; margin-bottom:15px;">By Narastore0719 x Apongsky</p>

    <div class="screen">
        <div id="timer" class="timer"></div>
        <video id="webcam" autoplay playsinline></video>
    </div>

    <div class="controls">
        <select id="filterSelect">
            <option value="none">Natural</option>
            <option value="brightness(1.1) saturate(1.2)">Seoul Glow</option>
            <option value="grayscale(100%) contrast(1.3)">Noir B&W</option>
        </select>
        <input type="color" id="frameColor" value="#ffffff">
    </div>

    <div class="sticker-box">
        <span class="sticker-item" onclick="addSticker('‚ù§Ô∏è')">‚ù§Ô∏è</span>
        <span class="sticker-item" onclick="addSticker('‚ú®')">‚ú®</span>
        <span class="sticker-item" onclick="addSticker('üéÄ')">üéÄ</span>
        <span class="sticker-item" onclick="addSticker('üê±')">üê±</span>
        <span class="sticker-item" onclick="addSticker('üî•')">üî•</span>
    </div>

    <button id="startBtn" onclick="startSession()">üì∏ AMBIL FOTO (4x)</button>

    <canvas id="finalCanvas"></canvas>
    <button id="downloadBtn" class="btn-save" onclick="downloadImage()">üíæ SIMPAN KE GALERI</button>

    <div style="margin-top:20px; border-top: 1px solid #3d4446; padding-top: 15px;">
        <a href="https://saweria.co/narastore0719" target="_blank" style="background:#feca57; color:#2d3436; text-decoration:none; font-weight:bold; padding:10px 20px; border-radius:10px; display:inline-block; font-size:14px;">‚òï Traktir Kopi (Saweria)</a>
    </div>
</div>

<script>
// (Logika JavaScript sama dengan sebelumnya untuk menghemat tempat)
const video = document.getElementById('webcam');
const timerEl = document.getElementById('timer');
const canvas = document.getElementById('finalCanvas');
const ctx = canvas.getContext('2d');
const downloadBtn = document.getElementById('downloadBtn');
let capturedImages = [], stickers = [];
const beep = new Audio("https://www.soundjay.com/button/beep-07.mp3");
const shutter = new Audio("https://www.soundjay.com/free-music/shutter-click-01.mp3");

navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } }).then(s => video.srcObject = s);

async function startSession() {
    capturedImages = []; stickers = [];
    canvas.style.display = 'none'; downloadBtn.style.display = 'none';
    for(let i=0; i<4; i++) {
        for(let c=3; c>=0; c--) {
            timerEl.innerText = c > 0 ? c : "";
            if(c > 0) beep.play();
            await new Promise(r => setTimeout(r, 1000));
        }
        document.body.classList.add('flash-active');
        shutter.play();
        takeSnap();
        setTimeout(() => document.body.classList.remove('flash-active'), 100);
    }
    renderAll();
    canvas.style.display = 'block'; downloadBtn.style.display = 'block';
}

function takeSnap() {
    const temp = document.createElement('canvas');
    temp.width = 1200; temp.height = 900;
    const tCtx = temp.getContext('2d');
    tCtx.filter = document.getElementById('filterSelect').value;
    tCtx.translate(1200,0); tCtx.scale(-1,1);
    tCtx.drawImage(video, 0, 0, 1200, 900);
    capturedImages.push(temp.toDataURL());
}

function renderAll() {
    canvas.width = 600; canvas.height = 1950;
    const bg = document.getElementById('frameColor').value;
    ctx.fillStyle = bg; ctx.fillRect(0,0,600,1950);
    const txtCol = isDark(bg) ? "#fff" : "#2d3436";
    ctx.fillStyle = txtCol; ctx.textAlign = "center";
    ctx.font = "bold 45px sans-serif"; ctx.fillText("NARABOOTH", 300, 90);
    capturedImages.forEach((src, i) => {
        const img = new Image();
        img.src = src;
        img.onload = () => {
            const y = 170 + (i * 430);
            ctx.fillStyle = "white"; 
            ctx.fillRect(45, y-5, 510, 385);
            ctx.drawImage(img, 50, y, 500, 375);
            if(i === 3) drawUI();
        };
    });
}

function addSticker(emoji) {
    stickers.push({ emoji, x: 300, y: 1000 });
    drawUI();
}

function drawUI() {
    renderAll();
    ctx.font = "70px serif";
    stickers.forEach(s => ctx.fillText(s.emoji, s.x, s.y));
}

canvas.addEventListener('touchmove', e => {
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    const x = (e.touches[0].clientX - rect.left) * (canvas.width / rect.width);
    const y = (e.touches[0].clientY - rect.top) * (canvas.height / rect.height);
    if(stickers.length > 0) {
        stickers[stickers.length-1].x = x;
        stickers[stickers.length-1].y = y;
        drawUI();
    }
}, {passive: false});

function downloadImage() {
    const link = document.createElement('a');
    link.download = `NaraBooth_${Date.now()}.png`;
    link.href = canvas.toDataURL();
    link.click();
}

function isDark(color) {
    const r = parseInt(color.substr(1,2),16);
    const g = parseInt(color.substr(3,2),16);
    const b = parseInt(color.substr(5,2),16);
    return (r*0.299 + g*0.587 + b*0.114) < 128;
}
</script>
</body>
</html>
