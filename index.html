<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NaraBooth Ultimate V11</title>
    <style>
        :root { --accent: #ff7675; --bg: #121212; --card: #1e1e1e; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; text-align: center; overflow-x: hidden; }
        
        .container { max-width: 450px; margin: auto; background: var(--card); padding: 20px; border-radius: 35px; box-shadow: 0 25px 50px rgba(0,0,0,0.6); border: 1px solid #333; }
        
        .screen { position: relative; background: #000; border-radius: 20px; overflow: hidden; aspect-ratio: 4/3; border: 3px solid #222; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .timer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 100px; font-weight: 900; z-index: 100; color: white; text-shadow: 0 0 20px var(--accent); }
        
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        select, input[type="color"] { background: #2d2d2d; border: 1px solid #444; color: white; padding: 12px; border-radius: 12px; font-weight: bold; outline: none; }

        .sticker-box { display: flex; gap: 15px; overflow-x: auto; padding: 10px; background: #111; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; }
        .sticker-item { font-size: 32px; cursor: pointer; min-width: 50px; transition: 0.2s; }
        .sticker-item:active { transform: scale(1.4); }

        #startBtn { width: 100%; background: linear-gradient(45deg, #ff7675, #ef5777); color: white; border: none; padding: 20px; border-radius: 18px; font-size: 18px; font-weight: 900; cursor: pointer; box-shadow: 0 10px 20px rgba(255, 118, 117, 0.3); }
        #startBtn:disabled { background: #444; opacity: 0.6; }

        canvas { max-width: 100%; border-radius: 15px; margin-top: 20px; display: none; touch-action: none; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        .btn-save { background: #00b894; color: white; border: none; padding: 18px; border-radius: 15px; width: 100%; margin-top: 15px; display: none; font-weight: bold; cursor: pointer; font-size: 16px; }
        
        .flash-active { background: #fff !important; transition: 0.05s; }
        .saweria-btn { background: #feca57; color: #2d3436; text-decoration: none; font-weight: 900; padding: 12px 25px; border-radius: 12px; display: inline-block; margin-top: 15px; font-size: 14px; box-shadow: 0 5px 15px rgba(254, 202, 87, 0.3); }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: left; margin-bottom: 15px;">
        <h2 style="margin:0; color:var(--accent); letter-spacing: 2px;">NARABOOTH <span style="font-weight:100; font-size:14px; color:#fff">V11</span></h2>
        <p style="font-size:10px; opacity:0.5; margin:0;">PREMIUM PHOTO EXPERIENCE BY APONGSKY</p>
    </div>

    <div class="screen">
        <div id="timer" class="timer"></div>
        <video id="webcam" autoplay playsinline></video>
    </div>

    <div class="controls">
        <select id="filterSelect">
            <option value="none">Default Studio</option>
            <option value="brightness(1.1) saturate(1.2) contrast(1.1)">Seoul Soft</option>
            <option value="grayscale(100%) contrast(1.3)">Noir Aesthetic</option>
            <option value="sepia(0.3) brightness(1.1)">Vintage 90s</option>
        </select>
        <input type="color" id="frameColor" value="#ffffff">
    </div>

    <div class="sticker-box">
        <span class="sticker-item" onclick="addSticker('‚ù§Ô∏è')">‚ù§Ô∏è</span>
        <span class="sticker-item" onclick="addSticker('‚ú®')">‚ú®</span>
        <span class="sticker-item" onclick="addSticker('üê±')">üê±</span>
        <span class="sticker-item" onclick="addSticker('üéÄ')">üéÄ</span>
        <span class="sticker-item" onclick="addSticker('üëë')">üëë</span>
        <span class="sticker-item" onclick="addSticker('üî•')">üî•</span>
        <span class="sticker-item" onclick="addSticker('üì∏')">üì∏</span>
    </div>

    <button id="startBtn" onclick="startSession()">üì∏ TAKE PHOTOSTRIP</button>

    <canvas id="finalCanvas"></canvas>
    <button id="downloadBtn" class="btn-save" onclick="downloadImage()">üíæ SAVE TO GALLERY</button>

    <div style="margin-top:20px; border-top: 1px solid #333; padding-top: 20px;">
        <p style="font-size:11px; opacity:0.5; margin-bottom:15px;">Tips: Klik stiker lalu geser di atas frame hasil foto!</p>
        <a href="https://saweria.co/narastore0719" target="_blank" class="saweria-btn">‚òï TRAKTIR KOPI (SAWERIA)</a>
    </div>
</div>

<script>
const video = document.getElementById('webcam');
const timerEl = document.getElementById('timer');
const canvas = document.getElementById('finalCanvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const downloadBtn = document.getElementById('downloadBtn');

let capturedImages = [], stickers = [], isDragging = false, activeSticker = null;
const beep = new Audio("https://www.soundjay.com/button/beep-07.mp3");
const shutter = new Audio("https://www.soundjay.com/free-music/shutter-click-01.mp3");

navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } }).then(s => video.srcObject = s);

async function startSession() {
    capturedImages = []; stickers = [];
    canvas.style.display = 'none'; downloadBtn.style.display = 'none';
    startBtn.disabled = true;

    for(let i=0; i<4; i++) {
        for(let c=3; c>=0; c--) {
            timerEl.innerText = c > 0 ? c : "";
            if(c > 0) beep.play();
            await new Promise(r => setTimeout(r, 1000));
        }
        document.body.classList.add('flash-active');
        shutter.play();
        takeSnap();
        setTimeout(() => document.body.classList.remove('flash-active'), 100);
    }
    renderAll();
    canvas.style.display = 'block'; downloadBtn.style.display = 'block';
    startBtn.disabled = false;
}

function takeSnap() {
    const temp = document.createElement('canvas');
    temp.width = 1200; temp.height = 900;
    const tCtx = temp.getContext('2d');
    tCtx.filter = document.getElementById('filterSelect').value;
    tCtx.translate(1200,0); tCtx.scale(-1,1);
    tCtx.drawImage(video, 0, 0, 1200, 900);
    capturedImages.push(temp.toDataURL());
}

function renderAll() {
    canvas.width = 600; canvas.height = 1950;
    const bg = document.getElementById('frameColor').value;
    ctx.fillStyle = bg; ctx.fillRect(0,0,600,1950);
    
    const txtCol = isDark(bg) ? "#fff" : "#2d3436";
    ctx.fillStyle = txtCol; ctx.textAlign = "center";
    ctx.font = "bold 42px sans-serif"; ctx.fillText("NARABOOTH", 300, 90);
    ctx.font = "12px sans-serif"; ctx.fillText("MEMORIES BY NARASTORE0719 x APONGSKY", 300, 120);

    capturedImages.forEach((src, i) => {
        const img = new Image();
        img.src = src;
        img.onload = () => {
            const y = 160 + (i * 435);
            ctx.fillStyle = "white"; 
            ctx.fillRect(45, y-5, 510, 385);
            ctx.drawImage(img, 50, y, 500, 375);
            if(i === 3) drawUI();
        };
    });
}

function addSticker(emoji) {
    stickers.push({ emoji, x: 300, y: 1000 });
    drawUI();
}

function drawUI() {
    renderAll();
    ctx.font = "75px serif";
    stickers.forEach(s => ctx.fillText(s.emoji, s.x, s.y));
}

// Touch Handling for Dragging Stickers
canvas.addEventListener('touchstart', e => {
    const rect = canvas.getBoundingClientRect();
    const x = (e.touches[0].clientX - rect.left) * (canvas.width / rect.width);
    const y = (e.touches[0].clientY - rect.top) * (canvas.height / rect.height);
    
    stickers.forEach((s, index) => {
        if (Math.hypot(s.x - x, s.y - y) < 60) {
            activeSticker = s;
            isDragging = true;
        }
    });
});

canvas.addEventListener('touchmove', e => {
    if (!isDragging || !activeSticker) return;
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    activeSticker.x = (e.touches[0].clientX - rect.left) * (canvas.width / rect.width);
    activeSticker.y = (e.touches[0].clientY - rect.top) * (canvas.height / rect.height);
    drawUI();
}, {passive: false});

canvas.addEventListener('touchend', () => { isDragging = false; activeSticker = null; });

function downloadImage() {
    const link = document.createElement('a');
    link.download = `NaraBooth_V11_${Date.now()}.png`;
    link.href = canvas.toDataURL('image/png');
    link.click();
}

function isDark(color) {
    const r = parseInt(color.substr(1,2),16);
    const g = parseInt(color.substr(3,2),16);
    const b = parseInt(color.substr(5,2),16);
    return (r*0.299 + g*0.587 + b*0.114) < 128;
}
</script>
</body>
</html>
